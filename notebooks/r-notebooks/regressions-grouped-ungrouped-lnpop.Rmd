---
title: "Grouped/Ungrouped Regressions with ln(population) to account for skew"
output: html_notebook
---

```{r}
library("dplyr")
cities <- read.csv('C:/Users/ather/CS Projects/CETLab/caeecc-energy-efficiency/cities_2.csv')
```

```{r}
#create ln_pop variable as ln(total_population)

cities$ln_pop = log(cities$total_population)
#group data by ln_pop
cities_lnq1 <- subset(cities, ln_pop < 9.5)
cities_lnq2 <- subset(cities, ln_pop >= 9.5 & ln_pop < 11.5)
cities_lnq3 <- subset(cities, ln_pop >= 11.5 & ln_pop < 12.5)
cities_lnq4 <- subset(cities, ln_pop > 12.5)

cities$budget_per_cap = cities$Budget / cities$total_population

cities$budget_per_taxrev = cities$Budget / cities$Total.Tax.Revenue

```


```{r}
#group information (count, means/ranges, visualization)
count(cities_lnq1)
count(cities_lnq2)
count(cities_lnq3)
count(cities_lnq4)

summary(cities_lnq1$total_population)
summary(cities_lnq2$total_population)
summary(cities_lnq3$total_population)
summary(cities_lnq4$total_population)

hist(cities_lnq1$total_population)
hist(cities_lnq2$total_population)
hist(cities_lnq3$total_population)
hist(cities_lnq4$total_population)
```

```{r}
#checking which variables would be closer to normal with log transform VST
hist(log(cities$Total.Tax.Revenue))
hist(log(cities$total_population))
hist(cities$ces_score_median)
hist(log(cities$median_household_income_usd))
hist(cities$dac_proportion)
hist(cities$ruca_average)
hist(log(cities$Budget))
```

```{r}
#regressions on groups
log_model = lm(log(Budget) ~ log(Total.Tax.Revenue) + log(total_population) + ces_score_median + log(median_household_income_usd) + dac_proportion + ruca_average, data = cities)
summary(log_model)
```

```{r}

quantile(cities_lnq1$Total.Tax.Revenue, na.rm = TRUE)
subset1 = subset(cities_lnq1, Total.Tax.Revenue < 6433281)
subset2 = subset(cities_lnq1, Total.Tax.Revenue >= 6433281 & Total.Tax.Revenue < 13961081)
subset3 = subset(cities_lnq1, Total.Tax.Revenue >= 13961081 & Total.Tax.Revenue < 37688401)
subset4 = subset(cities_lnq1, Total.Tax.Revenue >= 37688401)



t.test(subset1$budget_per_taxrev, subset2$budget_per_taxrev, na.action = na.omit)


```
```{r}
mean(cities_lnq1$budget_per_taxrev, na.rm = TRUE)
mean(cities_lnq2$budget_per_taxrev, na.rm = TRUE)
mean(cities_lnq3$budget_per_taxrev)
mean(cities_lnq4$budget_per_taxrev)

plot(cities$Total.Tax.Revenue, cities$Budget)

```

