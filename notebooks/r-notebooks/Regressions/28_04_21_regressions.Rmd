---
title: "regressions"
author: "Public Sector UWG Team"
date: "4/28/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = '~/Desktop/caeecc-energy-efficiency/for github/data')
```

```{r, load packages}
library(readr)
library(data.table)
library(dplyr)
library(ggplot2)
library(tidyverse)
library(psych)
library(car)
library(fitdistrplus)
```

```{r, EE Programs at the County Level}
#read in data for County EE programs 
counties <- read.csv("counties_1.csv")
```

```{r, county—check}
#scatter plot matrix to check for correlation between county population and investment/energy savings
plot.counties <- data.frame(counties$County, counties$Population, counties$Budget, counties$TotalFirstYearGrosskWh, counties$TotalRevenue) #subset out these variables
colnames(plot.counties)<-c("County", "Population", "Budget", "TotalFirstYearGrosskWh", "Total Revenue") #change column names back to original
pairs.panels(plot.counties, density = TRUE, cor=TRUE, lm=TRUE) #scatterplot
```
```{r, county}
#log-transform the population to account for the skew
counties$ln_Population <- log(counties$Population)
#visualize the normal distribution
hist(counties$ln_Population)
```
```{r}
#split into groups based on quantiles and population
counties_g1 <- subset(counties, Population <= 100000)
counties_g2 <- subset(counties, Population > 100000 & Population <= 200000)
counties_g3 <- subset(counties, Population > 200000 & Population <= 300000)
counties_g4 <- subset(counties, Population > 300000)
```


```{r, county}
#split into groups based on quantiles
quantile(counties$ln_Population)

#gr`oup data by ln_population
counties_lnq1 <- subset(counties, ln_Population < 10.768725)
counties_lnq2 <- subset(counties, ln_Population >= 10.768725 & ln_Population < 12.125893)
counties_lnq3 <- subset(counties, ln_Population >= 12.125893 & ln_Population < 13.439743)
counties_lnq4 <- subset(counties, ln_Population > 13.439743)
```
```{r, county}
#check the distribution of the predictor variable of interest (Budget)
hist(counties_lnq1$Budget)
hist(counties_lnq2$Budget)
hist(counties_lnq3$Budget)
hist(counties_lnq4$Budget)
```
```{r, county}
#check the distribution of the predictor variable of interest (Energy Savings)
hist(counties_lnq1$TotalFirstYearGrosskWh)
hist(counties_lnq2$TotalFirstYearGrosskWh)
hist(counties_lnq3$TotalFirstYearGrosskWh)
hist(counties_lnq4$TotalFirstYearGrosskWh)
```

```{r}
#round y because GLM works best with integers using quantiles split by just population 
counties_g1$rounded_budget <- round(counties_g1$Budget, 0)
counties_g2$rounded_budget <- round(counties_g2$Budget, 0)
counties_g3$rounded_budget <- round(counties_g3$Budget, 0)
counties_g4$rounded_budget <- round(counties_g4$Budget, 0)

counties_g1$rounded_kWh <- round(counties_g1$TotalFirstYearGrosskWh, 0)
counties_g2$rounded_kWh <- round(counties_g2$TotalFirstYearGrosskWh, 0)
counties_g3$rounded_kWh <- round(counties_g3$TotalFirstYearGrosskWh, 0)
counties_g4$rounded_kWh <- round(counties_g4$TotalFirstYearGrosskWh, 0)
```

```{r}
#check which distribution would be best for the budget of the SMALLEST population group
library(fitdistrplus)
counties1_pois <- fitdist(counties_g1$rounded_budget, "pois") #CHECK
counties1_nbin <- fitdist(counties_g1$rounded_budget, "nbinom") #CHECK

par(mfrow=c(1,2))
denscomp(list(counties1_pois, counties1_nbin))
qqcomp(list(counties1_pois, counties1_nbin))

summary(counties1_pois)
summary(counties1_nbin)
```

```{r}
#check which distribution would be best for the budget of the second SMALLEST population group
library(fitdistrplus)
counties2_pois <- fitdist(counties_g2$rounded_budget, "pois") #CHECK
counties2_nbin <- fitdist(counties_g2$rounded_budget, "nbinom") #CHECK

par(mfrow=c(1,2))
denscomp(list(counties2_pois, counties2_nbin))
qqcomp(list(counties2_pois, counties2_nbin))

summary(counties2_pois)
summary(counties2_nbin)
```

```{r}
#check which distribution would be best for the budget of the second LARGEST population group
library(fitdistrplus)
counties3_pois <- fitdist(counties_g3$rounded_budget, "pois") #CHECK
counties3_nbin <- fitdist(counties_g3$rounded_budget, "nbinom") #CHECK

par(mfrow=c(1,2))
denscomp(list(counties3_pois, counties3_nbin))
qqcomp(list(counties3_pois, counties3_nbin))

summary(counties3_pois)
summary(counties3_nbin)
```

```{r}
#check which distribution would be best for the budget of the LARGEST population group
library(fitdistrplus)
counties4_pois <- fitdist(counties_g4$rounded_budget, "pois") #CHECK
counties4_nbin <- fitdist(counties_g4$rounded_budget, "nbinom") #CHECK

par(mfrow=c(1,2))
denscomp(list(counties4_pois, counties4_nbin))
qqcomp(list(counties4_pois, counties4_nbin))

summary(counties4_pois)
summary(counties4_nbin)
```


```{r, county—check}
#round y because GLM works best with integers using quantiles split by log of population
counties_lnq1$rounded_budget <- round(counties_lnq1$Budget, 0)
counties_lnq2$rounded_budget <- round(counties_lnq2$Budget, 0)
counties_lnq3$rounded_budget <- round(counties_lnq3$Budget, 0)
counties_lnq4$rounded_budget <- round(counties_lnq4$Budget, 0)

counties_lnq1$rounded_kWh <- round(counties_lnq1$TotalFirstYearGrosskWh, 0)
counties_lnq2$rounded_kWh <- round(counties_lnq2$TotalFirstYearGrosskWh, 0)
counties_lnq3$rounded_kWh <- round(counties_lnq3$TotalFirstYearGrosskWh, 0)
counties_lnq4$rounded_kWh <- round(counties_lnq4$TotalFirstYearGrosskWh, 0)
```

```{r, county—check}
#check which distribution would be best for the budget of the SMALLEST population group
library(fitdistrplus)
county1_pois <- fitdist(counties_lnq1$rounded_budget, "pois") #CHECK
county1_nbin <- fitdist(counties_lnq1$rounded_budget, "nbinom") #CHECK

par(mfrow=c(1,2))
denscomp(list(county1_pois, county1_nbin))
qqcomp(list(county1_pois, county1_nbin))

summary(county1_pois)
summary(county1_nbin)
```
```{r}
#check which distribution would be best for the budget of the second SMALLEST population group
library(fitdistrplus)
county2_pois <- fitdist(counties_lnq2$rounded_budget, "pois") #CHECK
county2_nbin <- fitdist(counties_lnq2$rounded_budget, "nbinom") #CHECK

par(mfrow=c(1,2))
denscomp(list(county2_pois, county2_nbin))
qqcomp(list(county2_pois, county2_nbin))

summary(county2_pois)
summary(county2_nbin)
```

```{r}
#check which distribution would be best for the budget of the second LARGEST population group
library(fitdistrplus)
county3_pois <- fitdist(counties_lnq3$rounded_budget, "pois") #CHECK
county3_nbin <- fitdist(counties_lnq3$rounded_budget, "nbinom") #CHECK

par(mfrow=c(1,2))
denscomp(list(county3_pois, county3_nbin))
qqcomp(list(county3_pois, county3_nbin))

summary(county3_pois)
summary(county3_nbin)
```

```{r}
#check which distribution would be best for the budget of the LARGEST population group
library(fitdistrplus)
county4_pois <- fitdist(counties_lnq4$rounded_budget, "pois") #CHECK
county4_nbin <- fitdist(counties_lnq4$rounded_budget, "nbinom") #CHECK

par(mfrow=c(1,2))
denscomp(list(county4_pois, county4_nbin))
qqcomp(list(county4_pois, county4_nbin))

summary(county4_pois)
summary(county4_nbin)
```

```{r}
#Regression just using county data, not split into quantiles yet
counties1.glm <- glm(Budget ~ TotalRevenue, data = counties, family = "poisson")
counties2.glm <- glm(Budget ~ TotalRevenue + ces_score_median, data = counties, family = "poisson")
counties3.glm <- glm(Budget ~ TotalRevenue + ces_score_median + IRR, data = counties, family = "poisson")
counties4.glm <- glm(Budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income, data = counties, family = "poisson")
counties5.glm <- glm(Budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income + Population, data = counties, family = "poisson")

summary(counties1.glm) #p-value should be < 0.05 to be significant 
summary(counties2.glm)
summary(counties3.glm)
summary(counties4.glm)
summary(counties5.glm)
```

```{r}
result <- AIC(counties1.glm, counties2.glm, counties3.glm, counties4.glm, counties5.glm)
result1<-BIC(counties1.glm, counties2.glm, counties3.glm, counties4.glm, counties5.glm)
models <- list(counties1.glm, counties2.glm, counties3.glm, counties4.glm, counties5.glm)
result$BIC <- sapply(models, BIC)
model_summary <- lapply(models, summary)
model_summary
for(i in 1:length(models)){
  result$rsq[i] <- model_summary[[i]]$r.squared 
  result$adj_rsq[i] <- model_summary[[i]]$adj.r.squared 
} 

library(knitr)
kable(result, digits = 2, align = "c")
```

```{r}
#poisson budget regression for q1 using just population
counties1a.glm <- glm(rounded_budget ~ TotalRevenue, data = counties_g1, family = "poisson")
counties1b.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median, data = counties_g1, family = "poisson")
counties1c.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median + IRR, data = counties_g1, family = "poisson")
counties1d.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income, data = counties_g1, family = "poisson")
counties1e.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income + Population, data = counties_g1, family = "poisson")

summary(counties1a.glm) #p-value should be < 0.05 to be significant 
summary(counties1b.glm)
summary(counties1c.glm)
summary(counties1d.glm)
summary(counties1e.glm)
```

```{r}
#poisson energy savings regression for q1 with quantiles based on just population
counties1f.glm <- glm(rounded_kWh ~ TotalRevenue, data = counties_g1, family = "poisson")
counties1g.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median, data = counties_g1, family = "poisson")
counties1h.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median + IRR, data = counties_g1, family = "poisson")
counties1i.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median + IRR + Mean.Income, data = counties_g1, family = "poisson")
counties1j.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median + IRR + Mean.Income + Population, data = counties_g1, family = "poisson")

summary(counties1f.glm) #p-value should be < 0.05 to be significant 
summary(counties1g.glm)
summary(counties1h.glm)
summary(counties1i.glm)
summary(counties1j.glm)
```

```{r}
#poisson budget regression for q2 using just population
counties2a.glm <- glm(rounded_budget ~ TotalRevenue, data = counties_g2, family = "poisson")
counties2b.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median, data = counties_g2, family = "poisson")
counties2c.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median + IRR, data = counties_g2, family = "poisson")
counties2d.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income, data = counties_g2, family = "poisson")
counties2e.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income + Population, data = counties_g2, family = "poisson")

summary(counties2a.glm) #p-value should be < 0.05 to be significant 
summary(counties2b.glm)
summary(counties2c.glm)
summary(counties2d.glm)
summary(counties2e.glm)
```

```{r}
#poisson energy savings regression for q2 with quantiles based on just population
counties2f.glm <- glm(rounded_kWh ~ TotalRevenue, data = counties_g2, family = "poisson")
counties2g.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median, data = counties_g2, family = "poisson")
counties2h.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median + IRR, data = counties_g2, family = "poisson")
counties2i.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median + IRR + Mean.Income, data = counties_g2, family = "poisson")
counties2j.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median + IRR + Mean.Income + Population, data = counties_g2, family = "poisson")

summary(counties2f.glm) #p-value should be < 0.05 to be significant 
summary(counties2g.glm)
summary(counties2h.glm)
summary(counties2i.glm)
summary(counties2j.glm)
```

```{r}
#poisson budget regression for q3 using just population
counties3a.glm <- glm(rounded_budget ~ TotalRevenue, data = counties_g3, family = "poisson")
counties3b.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median, data = counties_g3, family = "poisson")
counties3c.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median + IRR, data = counties_g3, family = "poisson")
counties3d.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income, data = counties_g3, family = "poisson")
counties3e.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income + Population, data = counties_g3, family = "poisson")

summary(counties3a.glm) #p-value should be < 0.05 to be significant 
summary(counties3b.glm)
summary(counties3c.glm)
summary(counties3d.glm)
summary(counties3e.glm)
```

```{r}
#poisson energy savings regression for q3 with quantiles based on just population
counties3f.glm <- glm(rounded_kWh ~ TotalRevenue, data = counties_g3, family = "poisson")
counties3g.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median, data = counties_g3, family = "poisson")
counties3h.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median + IRR, data = counties_g3, family = "poisson")
counties3i.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median + IRR + Mean.Income, data = counties_g3, family = "poisson")
counties3j.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median + IRR + Mean.Income + Population, data = counties_g3, family = "poisson")

summary(counties3f.glm) #p-value should be < 0.05 to be significant 
summary(counties3g.glm)
summary(counties3h.glm)
summary(counties3i.glm)
summary(counties3j.glm)
```

```{r}
#poisson budget regression for q3 using just population
counties4a.glm <- glm(rounded_budget ~ TotalRevenue, data = counties_g4, family = "poisson")
counties4b.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median, data = counties_g4, family = "poisson")
counties4c.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median + IRR, data = counties_g4, family = "poisson")
counties4d.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income, data = counties_g4, family = "poisson")
counties4e.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income + Population, data = counties_g4, family = "poisson")

summary(counties4a.glm) #p-value should be < 0.05 to be significant 
summary(counties4b.glm)
summary(counties4c.glm)
summary(counties4d.glm)
summary(counties4e.glm)
```

```{r}
#poisson energy savings regression for q3 with quantiles based on just population
counties4f.glm <- glm(rounded_kWh ~ TotalRevenue, data = counties_g4, family = "poisson")
counties4g.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median, data = counties_g4, family = "poisson")
counties4h.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median + IRR, data = counties_g4, family = "poisson")
counties4i.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median + IRR + Mean.Income, data = counties_g4, family = "poisson")
counties4j.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median + IRR + Mean.Income + Population, data = counties_g4, family = "poisson")

summary(counties4f.glm) #p-value should be < 0.05 to be significant 
summary(counties4g.glm)
summary(counties4h.glm)
summary(counties4i.glm)
summary(counties4j.glm)
```

````{r, county}
#poisson budget regression for q1
counties_1a.glm <- glm(rounded_budget ~ TotalRevenue, data = counties_lnq1, family = "poisson")
counties_1b.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median, data = counties_lnq1, family = "poisson")
counties_1c.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median + IRR, data = counties_lnq1, family = "poisson")
counties_1d.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income, data = counties_lnq1, family = "poisson")
counties_1e.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income + Population, data = counties_lnq1, family = "poisson")

summary(counties_1a.glm) #p-value should be < 0.05 to be significant 
summary(counties_1b.glm)
summary(counties_1c.glm)
summary(counties_1d.glm)
summary(counties_1e.glm)
```
The code above shows 5 different combinations of variables. For each poisson regression, every variable is significant (weirdly with the same p-value of <2e-16 which is R's way of indicating a very small number) however there are small coefficients. IRR is most significant in this case.

```{r}
result <- AIC(counties_1a.glm, counties_1b.glm, counties_1c.glm, counties_1d.glm, counties_1e.glm)
result1<-BIC(counties_1a.glm, counties_1b.glm, counties_1c.glm, counties_1d.glm, counties_1e.glm)
models <- list(counties_1a.glm, counties_1b.glm, counties_1c.glm, counties_1d.glm, counties_1e.glm)
result$BIC <- sapply(models, BIC)
model_summary <- lapply(models, summary)
model_summary
for(i in 1:length(models)){
  result$rsq[i] <- model_summary[[i]]$r.squared 
  result$adj_rsq[i] <- model_summary[[i]]$adj.r.squared 
} 

library(knitr)
kable(result, digits = 2, align = "c")
```

```{r}
with(counties_1a.glm, cbind(res.deviance = deviance, df = df.residual,
  p = pchisq(deviance, df.residual, lower.tail=FALSE)))
with(counties_1b.glm, cbind(res.deviance = deviance, df = df.residual,
  p = pchisq(deviance, df.residual, lower.tail=TRUE)))
with(counties_1c.glm, cbind(res.deviance = deviance, df = df.residual,
  p = pchisq(deviance, df.residual, lower.tail=FALSE)))
with(counties_1d.glm, cbind(res.deviance = deviance, df = df.residual,
  p = pchisq(deviance, df.residual, lower.tail=FALSE)))
with(counties_1e.glm, cbind(res.deviance = deviance, df = df.residual,
  p = pchisq(deviance, df.residual, lower.tail=FALSE)))
```


````{r, county}
#poisson energy savings regression for q1
counties_1f.glm <- glm(rounded_kWh ~ TotalRevenue, data = counties_lnq1, family = "poisson")
counties_1g.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median, data = counties_lnq1, family = "poisson")
counties_1h.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median + IRR, data = counties_lnq1, family = "poisson")
counties_1i.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median + IRR + Mean.Income, data = counties_lnq1, family = "poisson")
counties_1j.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median + IRR + Mean.Income + Population, data = counties_lnq1, family = "poisson")

summary(counties_1f.glm) #p-value should be < 0.05 to be significant 
summary(counties_1g.glm)
summary(counties_1h.glm)
summary(counties_1i.glm)
summary(counties_1j.glm)
```

```{r, county}
#validate your budget model
anova(counties_1a.glm, counties_1b.glm, counties_1c.glm, counties_1d.glm, counties_1e.glm, test="Chisq") #lower p-value means it explains the variance more which is best
AIC(counties_1a.glm, counties_1b.glm, counties_1c.glm, counties_1d.glm, counties_1e.glm) #the smaller the value the better
BIC(counties_1a.glm, counties_1b.glm, counties_1c.glm, counties_1d.glm, counties_1e.glm) #the smaller the value the better
```
The p-values from the anova gave <2.2e-16 error, but counties_1e.glm is shown to be the best regression based on the AIC and BIC values.

```{r, county}
#validate your energy savings model
anova(counties_1f.glm, counties_1g.glm, counties_1h.glm, counties_1i.glm, counties_1j.glm, test="Chisq") #lower p-value means it explains the variance more which is best
AIC(counties_1f.glm, counties_1g.glm, counties_1h.glm, counties_1i.glm, counties_1j.glm) #the smaller the value the better
BIC(counties_1f.glm, counties_1g.glm, counties_1h.glm, counties_1i.glm, counties_1j.glm) #the smaller the value the better
```

```{r}
#poisson budget regression for q2
counties_2a.glm <- glm(rounded_budget ~ TotalRevenue, data = counties_lnq2, family = "poisson")
counties_2b.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median, data = counties_lnq2, family = "poisson")
counties_2c.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median + IRR, data = counties_lnq2, family = "poisson")
counties_2d.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income, data = counties_lnq2, family = "poisson")
counties_2e.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income + Population, data = counties_lnq2, family = "poisson")

summary(counties_2a.glm) #p-value should be < 0.05 to be significant 
summary(counties_2b.glm)
summary(counties_2c.glm)
summary(counties_2d.glm)
summary(counties_2e.glm)
```

```{r}
#validate your budget model
anova(counties_2a.glm, counties_2b.glm, counties_2c.glm, counties_2d.glm, counties_2e.glm, test="Chisq") #lower p-value means it explains the variance more which is best
AIC(counties_2a.glm, counties_2b.glm, counties_2c.glm, counties_2d.glm, counties_2e.glm) #the smaller the value the better
BIC(counties_2a.glm, counties_2b.glm, counties_2c.glm, counties_2d.glm, counties_2e.glm) #the smaller the value the better
```

```{r}
#poisson energy savings regression for q2
counties_2f.glm <- glm(rounded_kWh ~ TotalRevenue, data = counties_lnq2, family = "poisson")
counties_2g.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median, data = counties_lnq2, family = "poisson")
counties_2h.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median + IRR, data = counties_lnq2, family = "poisson")
counties_2i.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median + IRR + Mean.Income, data = counties_lnq2, family = "poisson")
counties_2j.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median + IRR + Mean.Income + Population, data = counties_lnq2, family = "poisson")

summary(counties_2f.glm) #p-value should be < 0.05 to be significant 
summary(counties_2g.glm)
summary(counties_2h.glm)
summary(counties_2i.glm)
summary(counties_2j.glm)
```

```{r}
#validate your energy savings model
anova(counties_2f.glm, counties_2g.glm, counties_2h.glm, counties_2i.glm, counties_2j.glm, test="Chisq") #lower p-value means it explains the variance more which is best
AIC(counties_2f.glm, counties_2g.glm, counties_2h.glm, counties_2i.glm, counties_2j.glm) #the smaller the value the better
BIC(counties_2f.glm, counties_2g.glm, counties_2h.glm, counties_2i.glm, counties_2j.glm) #the smaller the value the better
```

```{r}
#poisson budget regression for q3
counties_3a.glm <- glm(rounded_budget ~ TotalRevenue, data = counties_lnq3, family = "poisson")
counties_3b.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median, data = counties_lnq3, family = "poisson")
counties_3c.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median + IRR, data = counties_lnq3, family = "poisson")
counties_3d.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income, data = counties_lnq3, family = "poisson")
counties_3e.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income + Population, data = counties_lnq3, family = "poisson")

summary(counties_3a.glm) #p-value should be < 0.05 to be significant 
summary(counties_3b.glm)
summary(counties_3c.glm)
summary(counties_3d.glm)
summary(counties_3e.glm)
```

```{r}
#validate your budget model
anova(counties_3a.glm, counties_3b.glm, counties_3c.glm, counties_3d.glm, counties_3e.glm, test="Chisq") #lower p-value means it explains the variance more which is best
AIC(counties_3a.glm, counties_3b.glm, counties_3c.glm, counties_3d.glm, counties_3e.glm) #the smaller the value the better
BIC(counties_3a.glm, counties_3b.glm, counties_3c.glm, counties_3d.glm, counties_3e.glm) #the smaller the value the better
```

```{r}
#poisson energy savings regression for q3
counties_3f.glm <- glm(rounded_kWh ~ TotalRevenue, data = counties_lnq3, family = "poisson")
counties_3g.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median, data = counties_lnq3, family = "poisson")
counties_3h.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median + IRR, data = counties_lnq3, family = "poisson")
counties_3i.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median + IRR + Mean.Income, data = counties_lnq3, family = "poisson")
counties_3j.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median + IRR + Mean.Income + Population, data = counties_lnq3, family = "poisson")

summary(counties_3f.glm) #p-value should be < 0.05 to be significant 
summary(counties_3g.glm)
summary(counties_3h.glm)
summary(counties_3i.glm)
summary(counties_3j.glm)
```

```{r}
#validate your energy savings model
anova(counties_3f.glm, counties_3g.glm, counties_3h.glm, counties_3i.glm, counties_3j.glm, test="Chisq") #lower p-value means it explains the variance more which is best
AIC(counties_3f.glm, counties_3g.glm, counties_3h.glm, counties_3i.glm, counties_3j.glm) #the smaller the value the better
BIC(counties_3f.glm, counties_3g.glm, counties_3h.glm, counties_3i.glm, counties_3j.glm) #the smaller the value the better
```

```{r}
#poisson budget regression for q4
counties_4a.glm <- glm(rounded_budget ~ TotalRevenue, data = counties_lnq4, family = "poisson")
counties_4b.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median, data = counties_lnq4, family = "poisson")
counties_4c.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median + IRR, data = counties_lnq4, family = "poisson")
counties_4d.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income, data = counties_lnq4, family = "poisson")
counties_4e.glm <- glm(rounded_budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income + Population, data = counties_lnq4, family = "poisson")

summary(counties_4a.glm) #p-value should be < 0.05 to be significant 
summary(counties_4b.glm)
summary(counties_4c.glm)
summary(counties_4d.glm)
summary(counties_4e.glm)
```

```{r}
#validate your budget model
anova(counties_4a.glm, counties_4b.glm, counties_4c.glm, counties_4d.glm, counties_4e.glm, test="Chisq") #lower p-value means it explains the variance more which is best
AIC(counties_4a.glm, counties_4b.glm, counties_4c.glm, counties_4d.glm, counties_4e.glm) #the smaller the value the better
BIC(counties_4a.glm, counties_4b.glm, counties_4c.glm, counties_4d.glm, counties_4e.glm) #the smaller the value the better
```

```{r}
#poisson energy savings regression for q4
counties_4f.glm <- glm(rounded_kWh ~ TotalRevenue, data = counties_lnq4, family = "poisson")
counties_4g.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median, data = counties_lnq4, family = "poisson")
counties_4h.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median + IRR, data = counties_lnq4, family = "poisson")
counties_4i.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median + IRR + Mean.Income, data = counties_lnq4, family = "poisson")
counties_4j.glm <- glm(rounded_kWh ~ TotalRevenue + ces_score_median + IRR + Mean.Income + Population, data = counties_lnq4, family = "poisson")

summary(counties_4f.glm) #p-value should be < 0.05 to be significant 
summary(counties_4g.glm)
summary(counties_4h.glm)
summary(counties_4i.glm)
summary(counties_4j.glm)
```

```{r}
#validate your energy savings model
anova(counties_4f.glm, counties_4g.glm, counties_4h.glm, counties_4i.glm, counties_4j.glm, test="Chisq") #lower p-value means it explains the variance more which is best
AIC(counties_4f.glm, counties_4g.glm, counties_4h.glm, counties_4i.glm, counties_4j.glm) #the smaller the value the better
BIC(counties_4f.glm, counties_4g.glm, counties_4h.glm, counties_4i.glm, counties_4j.glm) #the smaller the value the better
```

```{r}
#negative binomial budget model
counties1_glm.nb <- glm.nb(Budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income + Population, data = counties)
counties2_glm.nb <- glm.nb(Budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income, data = counties)
counties3_glm.nb <- glm.nb(Budget ~ TotalRevenue + ces_score_median + IRR, data = counties)
counties4_glm.nb <- glm.nb(Budget ~ TotalRevenue + ces_score_median, data = counties)
counties5_glm.nb <- glm.nb(Budget ~ TotalRevenue, data = counties)


summary(counties1_glm.nb)#p-value should be < 0.05 to be significant
summary(counties2_glm.nb)
summary(counties3_glm.nb)
summary(counties4_glm.nb)
summary(counties5_glm.nb)
```


```{r, county—check}
#negative binomial budget model
counties1a_glm.nb <- glm.nb(rounded_budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income + Population, data = counties_lnq1)
counties1b_glm.nb <- glm.nb(rounded_budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income, data = counties_lnq1)
counties1c_glm.nb <- glm.nb(rounded_budget ~ TotalRevenue + ces_score_median + IRR, data = counties_lnq1)
counties1d_glm.nb <- glm.nb(rounded_budget ~ TotalRevenue + ces_score_median, data = counties_lnq1)
counties1e_glm.nb <- glm.nb(rounded_budget ~ TotalRevenue, data = counties_lnq1)


summary(counties1a_glm.nb)#p-value should be < 0.05 to be significant
summary(counties1b_glm.nb)
summary(counties1c_glm.nb)
summary(counties1d_glm.nb)
summary(counties1e_glm.nb)
```

```{r}
#Checking to see if the regression actually fits the dat
with(counties1a_glm.nb, cbind(res.deviance = deviance, df = df.residual,
  p = pchisq(deviance, df.residual, lower.tail=TRUE)))
with(counties1b_glm.nb, cbind(res.deviance = deviance, df = df.residual,
  p = pchisq(deviance, df.residual, lower.tail=TRUE)))
with(counties1c_glm.nb, cbind(res.deviance = deviance, df = df.residual,
  p = pchisq(deviance, df.residual, lower.tail=TRUE)))
with(counties1d_glm.nb, cbind(res.deviance = deviance, df = df.residual,
  p = pchisq(deviance, df.residual, lower.tail=TRUE)))
with(counties1e_glm.nb, cbind(res.deviance = deviance, df = df.residual,
  p = pchisq(deviance, df.residual, lower.tail=TRUE)))
```


```{r, county—check}
#negative binomial energy savings model
counties1f_glm.nb <- glm.nb(rounded_kWh ~ TotalRevenue + ces_score_median + IRR + Mean.Income + Population, data = counties_lnq1)
counties1g_glm.nb <- glm.nb(rounded_kWh ~ TotalRevenue + ces_score_median + IRR + Mean.Income, data = counties_lnq1)
counties1h_glm.nb <- glm.nb(rounded_kWh ~ TotalRevenue + ces_score_median + IRR, data = counties_lnq1)
counties1i_glm.nb <- glm.nb(rounded_kWh ~ TotalRevenue + ces_score_median, data = counties_lnq1)
counties1j_glm.nb <- glm.nb(rounded_kWh ~ TotalRevenue, data = counties_lnq1)

summary(counties1f_glm.nb)
summary(counties1g_glm.nb)
summary(counties1h_glm.nb)
summary(counties1i_glm.nb)
summary(counties1j_glm.nb)
```

```{r}
#negative binomial budget model
counties2a_glm.nb <- glm.nb(rounded_budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income + Population, data = counties_lnq2)
counties2b_glm.nb <- glm.nb(rounded_budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income, data = counties_lnq2)
counties2c_glm.nb <- glm.nb(rounded_budget ~ TotalRevenue + ces_score_median + IRR, data = counties_lnq2)
counties2d_glm.nb <- glm.nb(rounded_budget ~ TotalRevenue + ces_score_median, data = counties_lnq2)
counties2e_glm.nb <- glm.nb(rounded_budget ~ TotalRevenue, data = counties_lnq2)


summary(counties2a_glm.nb)#p-value should be < 0.05 to be significant
summary(counties2b_glm.nb)
summary(counties2c_glm.nb)
summary(counties2d_glm.nb)
summary(counties2e_glm.nb)
```

```{r}
#negative binomial energy savings model
counties2f_glm.nb <- glm.nb(rounded_kWh ~ TotalRevenue + ces_score_median + IRR + Mean.Income + Population, data = counties_lnq2)
counties2g_glm.nb <- glm.nb(rounded_kWh ~ TotalRevenue + ces_score_median + IRR + Mean.Income, data = counties_lnq2)
counties2h_glm.nb <- glm.nb(rounded_kWh ~ TotalRevenue + ces_score_median + IRR, data = counties_lnq2)
counties2i_glm.nb <- glm.nb(rounded_kWh ~ TotalRevenue + ces_score_median, data = counties_lnq2)
counties2j_glm.nb <- glm.nb(rounded_kWh ~ TotalRevenue, data = counties_lnq2)

summary(counties2f_glm.nb) #p-value should be < 0.05 to be significant 
summary(counties2g_glm.nb)
summary(counties2h_glm.nb)
summary(counties2i_glm.nb)
summary(counties2j_glm.nb)
```

```{r}
#negative binomial budget model
counties3a_glm.nb <- glm.nb(rounded_budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income + Population, data = counties_lnq3)
counties3b_glm.nb <- glm.nb(rounded_budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income, data = counties_lnq3)
counties3c_glm.nb <- glm.nb(rounded_budget ~ TotalRevenue + ces_score_median + IRR, data = counties_lnq3)
counties3d_glm.nb <- glm.nb(rounded_budget ~ TotalRevenue + ces_score_median, data = counties_lnq3)
counties3e_glm.nb <- glm.nb(rounded_budget ~ TotalRevenue, data = counties_lnq3)


summary(counties3a_glm.nb)#p-value should be < 0.05 to be significant
summary(counties3b_glm.nb)
summary(counties3c_glm.nb)
summary(counties3d_glm.nb)
summary(counties3e_glm.nb)
```

```{r}
#negative binomial energy savings model
counties3f_glm.nb <- glm.nb(rounded_kWh ~ TotalRevenue + ces_score_median + IRR + Mean.Income + Population, data = counties_lnq3)
counties3g_glm.nb <- glm.nb(rounded_kWh ~ TotalRevenue + ces_score_median + IRR + Mean.Income, data = counties_lnq3)
counties3h_glm.nb <- glm.nb(rounded_kWh ~ TotalRevenue + ces_score_median + IRR, data = counties_lnq3)
counties3i_glm.nb <- glm.nb(rounded_kWh ~ TotalRevenue + ces_score_median, data = counties_lnq3)
counties3j_glm.nb <- glm.nb(rounded_kWh ~ TotalRevenue, data = counties_lnq3)

summary(counties3f_glm.nb) #p-value should be < 0.05 to be significant 
summary(counties3g_glm.nb)
summary(counties3h_glm.nb)
summary(counties3i_glm.nb)
summary(counties3j_glm.nb)
```

```{r}
#negative binomial budget model
counties4a_glm.nb <- glm.nb(rounded_budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income + Population, data = counties_lnq4)
counties4b_glm.nb <- glm.nb(rounded_budget ~ TotalRevenue + ces_score_median + IRR + Mean.Income, data = counties_lnq4)
counties4c_glm.nb <- glm.nb(rounded_budget ~ TotalRevenue + ces_score_median + IRR, data = counties_lnq4)
counties4d_glm.nb <- glm.nb(rounded_budget ~ TotalRevenue + ces_score_median, data = counties_lnq4)
counties4e_glm.nb <- glm.nb(rounded_budget ~ TotalRevenue, data = counties_lnq4)


summary(counties4a_glm.nb)#p-value should be < 0.05 to be significant
summary(counties4b_glm.nb)
summary(counties4c_glm.nb)
summary(counties4d_glm.nb)
summary(counties4e_glm.nb)
```

```{r}
#negative binomial energy savings model
counties4f_glm.nb <- glm.nb(rounded_kWh ~ TotalRevenue + ces_score_median + IRR + Mean.Income + Population, data = counties_lnq4)
counties4g_glm.nb <- glm.nb(rounded_kWh ~ TotalRevenue + ces_score_median + IRR + Mean.Income, data = counties_lnq4)
counties4h_glm.nb <- glm.nb(rounded_kWh ~ TotalRevenue + ces_score_median + IRR, data = counties_lnq4)
counties4i_glm.nb <- glm.nb(rounded_kWh ~ TotalRevenue + ces_score_median, data = counties_lnq4)
counties4j_glm.nb <- glm.nb(rounded_kWh ~ TotalRevenue, data = counties_lnq4)

summary(counties4f_glm.nb) #p-value should be < 0.05 to be significant 
summary(counties4g_glm.nb)
summary(counties4h_glm.nb)
summary(counties4i_glm.nb)
summary(counties4j_glm.nb)
```

```{r, EE Programs at the City Level}
#read in data for City EE programs 
cities <- read.csv("cities_2.csv")
```

```{r, city—check}
#scatter plot matrix to check for correlation between city population and investment/energy savings
plot.cities <- data.frame(cities$SiteCity, cities$TotalFirstYearGrosskWh, cities$Budget, cities$total_population) #subset out these variables
colnames(plot.cities)<-c("SiteCity", "TotalFirstYearGrosskWh", "Budget", "total_population") #change column names back to original
pairs.panels(plot.cities, density = TRUE, cor=TRUE, lm=TRUE) #scatterplot
```

```{r, city}
#log-transform the population to account for the skew
cities$ln_population <- log(cities$total_population)
#visualize the normal distribution
hist(cities$ln_population)
```

```{r, city}
#split into groups based on quantiles
quantile(cities$ln_population)

#group data by ln_population
cities_lnq1 <- subset(cities, ln_population < 9.076352)
cities_lnq2 <- subset(cities, ln_population >= 9.076352 & ln_population < 10.124950)
cities_lnq3 <- subset(cities, ln_population >= 10.124950 & ln_population < 11.129408)
cities_lnq4 <- subset(cities, ln_population > 11.129408)
```

```{r, city}
#check the distribution of the predictor variable of interest (Budget)
hist(cities_lnq1$Budget)
hist(cities_lnq2$Budget)
hist(cities_lnq3$Budget)
hist(cities_lnq4$Budget)
```
```{r, city}
#check the distribution of the predictor variable of interest (Energy Savings)
hist(cities_lnq1$TotalFirstYearGrosskWh)
hist(cities_lnq2$TotalFirstYearGrosskWh)
hist(cities_lnq3$TotalFirstYearGrosskWh)
hist(cities_lnq4$TotalFirstYearGrosskWh)
```

```{r, city—check}
#round y because GLM works best with integers 
cities_lnq1$rounded_budget <- round(cities_lnq1$Budget, 0)
cities_lnq2$rounded_budget <- round(cities_lnq2$Budget, 0)
cities_lnq3$rounded_budget <- round(cities_lnq3$Budget, 0)
cities_lnq4$rounded_budget <- round(cities_lnq4$Budget, 0)

cities_lnq1$rounded_kWh <- round(cities_lnq1$TotalFirstYearGrosskWh, 0)
cities_lnq2$rounded_kWh <- round(cities_lnq2$TotalFirstYearGrosskWh, 0)
cities_lnq3$rounded_kWh <- round(cities_lnq3$TotalFirstYearGrosskWh, 0)
cities_lnq4$rounded_kWh <- round(cities_lnq4$TotalFirstYearGrosskWh, 0)
```

```{r, city—check}
#check which distribution would be best for the budget of the SMALLEST population group
cities1_pois <- fitdist(cities_lnq1$rounded_budget, "pois") #CHECK
cities1_nbin <- fitdist(cities_lnq1$rounded_budget, "nbinom") #CHECK

par(mfrow=c(1,2))
denscomp(list(cities1_pois, cities1_nbin))
qqcomp(list(cities1_pois, cities1_nbin))

summary(cities1_pois)
summary(cities1_nbin)
```

````{r, city}
#poisson budget regression for q1
cities_1a.glm <- glm(rounded_budget ~ Total.Tax.Revenue, data = cities_lnq1, family = "poisson")
cities_1b.glm <- glm(rounded_budget ~ Total.Tax.Revenue + ruca_average, data = cities_lnq1, family = "poisson")
cities_1c.glm <- glm(rounded_budget ~ Total.Tax.Revenue + ruca_average + ces_score_median, data = cities_lnq1, family = "poisson")
cities_1d.glm <- glm(rounded_budget ~ Total.Tax.Revenue +  ruca_average + ces_score_median + total_population, data = cities_lnq1, family = "poisson")
cities_1e.glm <- glm(rounded_budget ~ Total.Tax.Revenue + ruca_average + ces_score_median + total_population + median_household_income_usd, data = cities_lnq1, family = "poisson")

summary(cities_1a.glm) #p-value should be < 0.05 to be significant 
summary(cities_1b.glm)
summary(cities_1c.glm)
summary(cities_1d.glm)
summary(cities_1e.glm)
```

````{r, city}
#poisson energy savings regression for q1
cities_1f.glm <- glm(rounded_kWh ~ Total.Tax.Revenue, data = cities_lnq1, family = "poisson")
cities_1g.glm <- glm(rounded_kWh ~ Total.Tax.Revenue + ruca_average, data = cities_lnq1, family = "poisson")
cities_1h.glm <- glm(rounded_kWh ~ Total.Tax.Revenue + ruca_average + ces_score_median, data = cities_lnq1, family = "poisson")
cities_1i.glm <- glm(rounded_kWh ~ Total.Tax.Revenue +  ruca_average + ces_score_median + total_population, data = cities_lnq1, family = "poisson")
cities_1j.glm <- glm(rounded_kWh ~ Total.Tax.Revenue + ruca_average + ces_score_median + total_population + median_household_income_usd, data = cities_lnq1, family = "poisson")

summary(cities_1f.glm) #p-value should be < 0.05 to be significant 
summary(cities_1g.glm)
summary(cities_1h.glm)
summary(cities_1i.glm)
summary(cities_1j.glm)
```

```{r, city}
#regression on ungrouped city programs w/ total_pop; note budget and kWh are not rounded for this
citiesa.glm <- glm(TotalFirstYearGrosskWh ~ Total.Tax.Revenue + ruca_average + ces_score_median + total_population + median_household_income_usd, data = cities, family = "poisson")
citiesb.glm <- glm(Budget ~ Total.Tax.Revenue + ruca_average + ces_score_median + total_population + median_household_income_usd, data = cities, family = "poisson")

summary(citiesa.glm)
summary(citiesb.glm)
```

```{r, city}
#regression on ungrouped city programs w/ ln_pop; note budget and kWh are not rounded for this
citiesc.glm <- glm(TotalFirstYearGrosskWh ~ Total.Tax.Revenue + ruca_average + ces_score_median + ln_population + median_household_income_usd, data = cities, family = "poisson")
citiesd.glm <- glm(Budget ~ Total.Tax.Revenue + ruca_average + ces_score_median + ln_population + median_household_income_usd, data = cities, family = "poisson")

summary(citiesc.glm)
summary(citiesd.glm)
```

```{r, K12 Programs}
#read in data for K-12 EE programs 
K12 <- read.csv("k12_counties_2.csv")
```

```{r, K12—check}
#scatter plot matrix to check for correlation between school enrollment and investment/energy savings
plot.K12 <- data.frame(K12$county_name, K12$TotalFirstYearGrosskWh, K12$Budget, K12$total_lcff_entitlement, K12$enrollment) #subset out these variables
colnames(plot.K12)<-c("county_name", "TotalFirstYearGrosskWh", "Budget", "total_lcff_entitlement", "enrollment") #change column names back to original
pairs.panels(plot.K12, density = TRUE, cor=TRUE, lm=TRUE) #scatterplot
```

```{r, K12}
#log-transform the enrollment to account for the skew
K12$ln_enrollment <- log(K12$enrollment)
#visualize the normal distribution
hist(K12$ln_enrollment)
```

```{r, K12}
#split into groups
quantile(K12$ln_enrollment)

#group data by ln_population
K12_lnq1 <- subset(K12, ln_enrollment < 8.707481)
K12_lnq2 <- subset(K12, ln_enrollment >= 8.707481 & ln_enrollment < 10.336310)
K12_lnq3 <- subset(K12, ln_enrollment >= 10.336310 & ln_enrollment < 11.532670)
K12_lnq4 <- subset(K12, ln_enrollment > 11.532670)
```

```{r, K12}
#check the distribution of the predictor variable of interest (Budget)
hist(K12_lnq1$Budget)
hist(K12_lnq2$Budget)
hist(K12_lnq3$Budget)
hist(K12_lnq4$Budget)
```
```{r, K12}
#check the distribution of the predictor variable of interest (Energy Savings)
hist(K12_lnq1$TotalFirstYearGrosskWh)
hist(K12_lnq2$TotalFirstYearGrosskWh)
hist(K12_lnq3$TotalFirstYearGrosskWh)
hist(K12_lnq4$TotalFirstYearGrosskWh)
```
```{r, K12—check}
#round y because GLM works best with integers 
K12_lnq1$rounded_budget <- round(K12_lnq1$Budget, 0)
K12_lnq2$rounded_budget <- round(K12_lnq2$Budget, 0)
K12_lnq3$rounded_budget <- round(K12_lnq3$Budget, 0)
K12_lnq4$rounded_budget <- round(K12_lnq4$Budget, 0)

K12_lnq1$rounded_kWh <- round(K12_lnq1$TotalFirstYearGrosskWh, 0)
K12_lnq2$rounded_kWh <- round(K12_lnq2$TotalFirstYearGrosskWh, 0)
K12_lnq3$rounded_kWh <- round(K12_lnq3$TotalFirstYearGrosskWh, 0)
K12_lnq4$rounded_kWh <- round(K12_lnq4$TotalFirstYearGrosskWh, 0)
```

```{r, K12—check}
#check which distribution would be best for the budget of the SMALLEST population group
K121_pois <- fitdist(K12_lnq1$rounded_budget, "pois") #CHECK
K121_nbin <- fitdist(K12_lnq1$rounded_budget, "nbinom") #CHECK

par(mfrow=c(1,2))
denscomp(list(K121_pois, K121_nbin))
qqcomp(list(K121_pois, K121_nbin))

summary(K121_pois)
summary(K121_nbin)
```

````{r, K12}
#poisson budget regression for q1
K12_1a.glm <- glm(rounded_budget ~ total_lcff_entitlement + ces_score_median + IRR + median_household_income_usd + enrollment, data = K12_lnq1, family = "poisson")
K12_1b.glm <- glm(rounded_budget ~ total_lcff_entitlement + ces_score_median + IRR + median_household_income_usd + enrollment + no_title1_status, data = K12_lnq1, family = "poisson")
K12_1c.glm <- glm(rounded_budget ~ total_lcff_entitlement + ces_score_median + IRR + median_household_income_usd + enrollment + free_meal_count, data = K12_lnq1, family = "poisson")
K12_1d.glm <- glm(rounded_budget ~ total_lcff_entitlement + ces_score_median + IRR + median_household_income_usd + enrollment + free_meal_count + no_title1_status + frpm_count, data = K12_lnq1, family = "poisson")
K12_1e.glm <- glm(rounded_budget ~ IRR + ces_score_median + no_title1_status, data = K12_lnq1, family = "poisson")

summary(K12_1a.glm) #p-value should be < 0.05 to be significant 
summary(K12_1b.glm)
summary(K12_1c.glm)
summary(K12_1d.glm)
summary(K12_1e.glm)
```

````{r, K12}
#poisson energy savings regression for q1
K12_1f.glm <- glm(rounded_kWh ~ total_lcff_entitlement + ces_score_median + IRR + median_household_income_usd + enrollment, data = K12_lnq1, family = "poisson")
K12_1g.glm <- glm(rounded_kWh ~ total_lcff_entitlement + ces_score_median + IRR + median_household_income_usd + enrollment + no_title1_status, data = K12_lnq1, family = "poisson")
K12_1h.glm <- glm(rounded_kWh ~ total_lcff_entitlement + ces_score_median + IRR + median_household_income_usd + enrollment + free_meal_count, data = K12_lnq1, family = "poisson")
K12_1i.glm <- glm(rounded_kWh ~ total_lcff_entitlement + ces_score_median + IRR + median_household_income_usd + enrollment + free_meal_count + no_title1_status + frpm_count, data = K12_lnq1, family = "poisson")
K12_1j.glm <- glm(rounded_kWh ~ IRR + ces_score_median + no_title1_status, data = K12_lnq1, family = "poisson")

summary(K12_1f.glm) #p-value should be < 0.05 to be significant 
summary(K12_1g.glm)
summary(K12_1h.glm)
summary(K12_1i.glm)
summary(K12_1j.glm)
```

```{r, K12}
#validate your budget model
anova(K12_1a.glm, K12_1b.glm, K12_1c.glm, K12_1d.glm, K12_1e.glm, test="Chisq") #lower p-value means it explains the variance more which is best
AIC(K12_1a.glm, K12_1b.glm, K12_1c.glm, K12_1d.glm, K12_1e.glm) #the smaller the value the better
BIC(K12_1a.glm, K12_1b.glm, K12_1c.glm, K12_1d.glm, K12_1e.glm) #the smaller the value the better
```
```{r, K12}
#validate your energy savings model
anova(K12_1f.glm, K12_1g.glm, K12_1h.glm, K12_1i.glm, K12_1j.glm, test="Chisq") #lower p-value means it explains the variance more which is best
AIC(K12_1f.glm, K12_1g.glm, K12_1h.glm, K12_1i.glm, K12_1j.glm) #the smaller the value the better
BIC(K12_1f.glm, K12_1g.glm, K12_1h.glm, K12_1i.glm, K12_1j.glm) #the smaller the value the better
```

```{r, K-12—check}
#negative binomial budget model
K121a_glm.nb <- glm.nb(rounded_budget ~ total_lcff_entitlement + ces_score_median + IRR + median_household_income_usd + enrollment, data = K12_lnq1)
summary(K121a_glm.nb)
```
```{r, K-12—check}
#negative binomial energy savings model
K121b_glm.nb <- glm.nb(rounded_kWh ~ total_lcff_entitlement + ces_score_median + IRR + median_household_income_usd + enrollment, data = K12_lnq1)
summary(K121b_glm.nb)
```

